https://sysahelper.ru/mod/page/view.php?id=507
### Задание:

1) Подготовка машины ControlVM

- a) Общие указания: 
    - 1. Вся проверка выполнения задания будет осуществляться с машины ControlVM.
    - 2. НЕ удаляйте инстанс ControlVM после завершения задания.
- b) Создание и настройка инстанса ControlVM:   
    - 1. Создайте виртуальный инстанс с именем ControlVM и подключите его к сети интернет.
    - 2. Установите следующие параметры для виртуальной машины: 
        - i. Тип виртуальной машины: 2 vCPU, 4 ГБ RAM.
        - ii. Размер диска: 30 ГБ.
        - ~~iii. Тип диска: SSD.~~
    - ~~3. Отключите функции мониторинга и резервного копирования для данного инстанса.~~
    - 4. В качестве операционной системы выберите Альт Сервер 10.
    - 5. Настройте инстанс для разрешения внешних подключений по протоколу SSH.
    - 6. Сохраните ключевую пару для доступа на вашем локальном ПК на рабочем столе с расширением .pem.
- c) Настройка внешнего подключения к ControlVM: 
    - ~~1. Установите на локальный ПК клиент SSH PuTTY.~~
    - 2. Создайте в PuTTY профиль с именем cloud.
    - 3. Убедитесь в возможности установления соединения с инстансом ControlVM с локального ПК через PuTTY, без необходимости ввода дополнительных параметров.
    - 4. Для подключения используйте имя пользователя altlinux и ранее сохранённую ключевую пару.

### Вариант реализации:

- Создаём ключевую пару для доступа к ControlVM на рабочем столе с расширением '**.pem**':

```
puttygen -t rsa -b 2048 -o Рабочий\ стол/cloud.pem
```

- Результат:

![](https://sysahelper.ru/pluginfile.php/865/mod_page/content/3/image.png)

- Открываем в блокноте сгенерированный ключ и копируем заголовок **ssh-rsa** и публичную часть ключа:
    - Заголовок и публичную часть ключа необходимо будет поместить в Кибер Инфраструктура далее

![](https://sysahelper.ru/pluginfile.php/865/mod_page/content/3/image%20%281%29.png)

- В веб-интерфейсе Кибер Инфраструктура создаём SSH-ключ:
    - В разделе **SSH-ключи** нажимаем **Добавить SSH-ключ** и даём понятное имя и ранее скопированное **Значение ключа** и нажимаем **Добавить**:

![](https://sysahelper.ru/pluginfile.php/865/mod_page/content/3/image%20%282%29.png)

- Результат:
    - Созданный **SSH-ключ** с именем **cloud**:

![](https://sysahelper.ru/pluginfile.php/865/mod_page/content/3/image%20%283%29.png)

- Для создания **ControVM** и подключения к ней с доступом в сеть Интернет, процесс создания зависит от настройки Кибер Инфраструктуры, а именно сети '**public**', которая будет предоставлять Плавающие IP:
    - Если на сеть выданы права **Все права** - Предоставление полного доступа позволит виртуальным машинам в выбранных проектах обмениваться трафиком с данной сетью напрямую или через виртуальные маршрутизаторы.
        - Тогда для **ControlVM**  достаточно просто подключить данную сеть и подключаться по полученному IP-адресу;
    - Если на сеть выданы права **Маршрутизируемый** - Предоставление маршрутизируемого доступа позволит виртуальным машинам в выбранных проектах обмениваться трафиком с данной сетью только через виртуальные маршрутизаторы.
        - Тогда для **ControlVM** потребуется предварительно создать:
            - Виртуальную подсеть;
            - Виртуальный маршрутизатор, который будет маршртитизировать в сеть Интернет (SNAT);
            - Плавающий IP ассоциируемый с данной виртуальной машиной;

- Рассмотрим процесс создания **ControlVM** когда для её работы неоходимо создать ряд вспомогательных ресурсов описанных выше:
    - Создадим виртуальную подсеть с именем **cloud**:
    - Имя может быть произвольным, но для наглядности все рессурсы необходимые для работы **ControlVM** будут именоваться **cloud**, чтобы в дальнейшем не удалить их случайно;

![](https://sysahelper.ru/pluginfile.php/865/mod_page/content/3/image%20%284%29.png)

![](https://sysahelper.ru/pluginfile.php/865/mod_page/content/3/image%20%285%29.png)

![](https://sysahelper.ru/pluginfile.php/865/mod_page/content/3/image%20%287%29.png)

- Результат:
    - Созданная виртуальная сеть с именем **cloud** необходимая для работы **ControlVM** (не удалять в конце выполнения задания, ресурс необходим для работы ControlVM):

![](https://sysahelper.ru/pluginfile.php/865/mod_page/content/3/image%20%288%29.png)

- Создадим Виртуальный маршрутизатор с именем **cloud**:
    - Имя может быть произвольным, но для наглядности все рессурсы необходимые для работы **ControlVM** будут именоваться **cloud**, чтобы в дальнейшем не удалить их случайно;

![](https://sysahelper.ru/pluginfile.php/865/mod_page/content/3/image%20%289%29.png)

- Результат:
    - Созданный виртуальный маршрутизатор с именем **cloud** необходимая для работы **ControlVM** (не удалять в конце выполнения задания, ресурс необходим для работы ControlVM):

![](https://sysahelper.ru/pluginfile.php/865/mod_page/content/3/image%20%2810%29.png)

- Создаём инстанс (виртуальную машину) **ControlVM**:
    - Задаём имя в соответствие с заданмем;
    - Выбираем образ **alt0server-p10-cloud**, т.к. по заданию ControlVM должен быть на Альт Сервер;
    - Размер диска следует поменять с **5** на **30**, т.к. по заданию должно быть **30**;
    - Выбираем **Тип ВМ** который соответствует требованиям задания **2vCPU** и **4RAM**;
    - **Сетевой интерфейс** подключаем к ранее созданной виртуальной сети **cloud**;
    - В качестве **SSH-ключа** указываем ранее созданный **cloud**:

![](https://sysahelper.ru/pluginfile.php/865/mod_page/content/3/image%20%2811%29.png)

![](https://sysahelper.ru/pluginfile.php/865/mod_page/content/3/image%20%2812%29.png)

![](https://sysahelper.ru/pluginfile.php/865/mod_page/content/3/image%20%2813%29.png)

![](https://sysahelper.ru/pluginfile.php/865/mod_page/content/3/image%20%2814%29.png)

- Результат:
    - Созданная виртуальная машина **ControlVM** в соответствие с требованиями задания:

![](https://sysahelper.ru/pluginfile.php/865/mod_page/content/3/image%20%2815%29.png)

- Создаём **Плавающий IP** чтобы можно было подключиться к **ControlVM**:

![](https://sysahelper.ru/pluginfile.php/865/mod_page/content/3/image%20%2816%29.png)

- Результат:
    - Созданный **Плавающий IP** адрес назначенный **ControlVM**:

![](https://sysahelper.ru/pluginfile.php/865/mod_page/content/3/image%20%2817%29.png)

- Для подключения к **ControlVM** создаём профиль в **putty**:
    - Используя для подключения **Плавающий IP** адрес и ранее сгенерированную ключевую пару на **Рабочем столе**:

![](https://sysahelper.ru/pluginfile.php/865/mod_page/content/3/image%20%2818%29.png)

![](https://sysahelper.ru/pluginfile.php/865/mod_page/content/3/image%20%2819%29.png)

![](https://sysahelper.ru/pluginfile.php/865/mod_page/content/3/image%20%2820%29.png)

![](https://sysahelper.ru/pluginfile.php/865/mod_page/content/3/image%20%2821%29.png)

- Результат:
    - Подключение к **ControlVM** под пользователем **altlinux** на основе **ключевой пары** используя **putty**:

![](https://sysahelper.ru/pluginfile.php/865/mod_page/content/3/image%20%2822%29.png)

- Проверяем сетевые параметры и доступ в сеть Интернет:

![](https://sysahelper.ru/pluginfile.php/865/mod_page/content/3/image%20%2823%29.png)